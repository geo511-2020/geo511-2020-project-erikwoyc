---
title: "Price Analysis for Single Family Housing in Buffalo" 
author: Erik Woyciesjes
subtitle: "2017 - 2020"
---

# Introduction

Within the context of recent economic growth within the City of Buffalo (before Covid-19), 
this project will examine changes in Single Family Housing Prices from 2017 - 2020. Buffalo has experienced rising real estate values in response to economic development projects, university expansions and workforce development programs. This project will compare changes in housing prices
across neighborhoods and investigate possible factors that influence housing prices such as number of bathrooms, bedrooms and total living area. 

# Materials and methods


Sources: 
Open Data Buffalo, Tax Assessment Data 2017 - 2020
Open Data Buffalo, Neighborhood Boundary Shapefile


# Packages

```{r, message=F, warning=F, results='hide'}
library(tidyverse)
library(ggplot2)
library(ggmap)
library(maptools)
library(ggthemes)
library(rgeos)
library(broom)
library(plyr)
library(dplyr)
library(grid)
library(gridExtra)
library(reshape2)
library(scales)
library(sp)
library(sf)
library(rgdal)
library(RColorBrewer)
library(kableExtra)
library(leaflet)
knitr::opts_chunk$set(cache=TRUE) 
```

## Data Download & Cleaning
```{r, message=F, warning=F, results='hide'}
# 2017 - 2019 Buffalo Assessment Roll
Parcel17 <- read.csv(file = "https://raw.githubusercontent.com/geo511-2020/geo511-2020-project-erikwoyc/master/2017-2018_Assessment_Roll.csv")
SingleFam_propclass <- c("210", "215", "240", "241", "250", "270")
Buffalo_17 <- filter(Parcel17, PROPERTY.CLASS %in% SingleFam_propclass)

# 2019 - 2020 Buffalo Assessment Roll
Parcel20 <- read.csv(file = "https://raw.githubusercontent.com/geo511-2020/geo511-2020-project-erikwoyc/master/2019-2020_Assessment_Roll.csv")
SingleFam_propclass <- c("210", "215", "240", "241", "250", "270")
Buffalo_20 <- filter(Parcel20, PROPERTY.CLASS %in% SingleFam_propclass)

# Neighborhood Shapefile
Neighborhood_URL <- "https://data.buffalony.gov/api/geospatial/q9bk-zu3p?method=export&format=GeoJSON"
Buffalo_Neighborhoods <- st_read(dsn = Neighborhood_URL)
Buffalo_sp <- as_Spatial(Buffalo_Neighborhoods)

```

#Snapshot of Assessment Data from 2017 - 2018
```{r, message=F, warning=F}
Parcel17 %>% 
  slice(1:10) %>% 
  kable(digits=2,align="c") %>% 
  kable_styling(bootstrap_options = 
                  c("striped", "hover", "condensed", "responsive")) 
```

# Data Exploration

```{r, message=F, warning=F, class.source="fold-hide"}
# 2017 - 2018 Single Family Housing Price Histogram
Plot_2017 <- ggplot(data = Buffalo_17, mapping = aes(x = TOTAL.VALUE)) + 
  geom_histogram() + xlab("Total Property Value($)") + ylab("Count") +
  scale_fill_manual(values="lightblue") + theme_few() +
  labs(x="Total Value($)", y="Count", title="Distribution of Buffalo Home Prices",
       subtitle="Single Family Property Prices (2017 - 2018)", 
       caption="Source: Buffalo Open Data") + scale_x_continuous() + scale_y_continuous()
plot(Plot_2017)
```


```{r, message=F, warning=F, class.source="fold-hide"}
# 2019 - 2020 Single Family Housing Price Histogram
Plot_2019 <- ggplot(data = Buffalo_20, mapping = aes(x = TOTAL.VALUE)) + 
  geom_histogram() + xlab("Total Property Value($)") + ylab("Count") +
  scale_fill_manual(values="lightblue") + theme_few() +
  labs(x="Total Value($)", y="Count", title="Distribution of Buffalo Home Prices",
       subtitle="Single Family Property Prices (2019 - 2020)", 
       caption="Source: Buffalo Open Data") + scale_x_continuous() + scale_y_continuous()
plot(Plot_2019)
```


# Buffalo Base Map
```{r, message=F, warning=F, results='hide', class.source="fold-hide"}
#Buffalo Bounding Box
Buffalo_bbox <- Buffalo_sp@bbox

# Download the basemap
basemap <- get_stamenmap(
  bbox = Buffalo_bbox,
  zoom = 13,
  maptype = "toner-lite")

# View Map
BFMap <- ggmap(basemap) + 
  labs(title="Buffalo Basemap")
BFMap
```

# 2017 - 2018 Assessment Roll Plot
```{r, message=F, warning=F}
SingleFam17 <- ggmap(basemap) +
  geom_point(data = Buffalo_17, aes(x = LONGITUDE, y = LATITUDE, color = TOTAL.VALUE), 
             size = .025, alpha = 0.7) +
  scale_color_gradient("Single Family Home Price", low = "light green", high = "dark green", trans="log",
                       labels = scales::dollar_format(prefix = "$")) +
  labs(title="Distribution of Buffalo Home Prices",
       subtitle="Property Prices (2017 - 2018)",
       caption="Open Data Buffalo")
SingleFam17
```

# 2019 - 2020 Assessment Roll Plot
```{r, message=F, warning=F}
SingleFam20 <- ggmap(basemap) + 
  geom_point(data = Buffalo_20, aes(x = LONGITUDE, y = LATITUDE, color = TOTAL.VALUE), 
             size = .025, alpha = 0.7) +
  scale_color_gradient("Single Family Home Price", low = "light green", high = "dark green", trans="log",
                       labels = scales::dollar_format(prefix = "$")) +
  labs(title="Distribution of Buffalo Home Prices",
       subtitle="Property Prices (2019 - 2020)",
       caption="Open Data Buffalo")
SingleFam20
```

# Interactive Map of Single Family Home Prices 2017 - 2020
```{r, message=F, warning=F, class.source="fold-hide"}

#Color Pallette
pallete <- colorNumeric("viridis", NULL)

Neighborhood_map <- leaflet() %>%
  setMaxBounds(lng1 = -78.91246, lat1 = 42.82603, lng2 = -78.79504, lat2 = 42.96641) %>%
  addProviderTiles("CartoDB") %>%
  addProviderTiles("Stamen.TonerLines",
                   options = providerTileOptions(opacity = 0.35)) %>%
  addCircles(data = Buffalo_17, lng = Buffalo_17$LONGITUDE, lat = Buffalo_17$LATITUDE, 
             color = ~pallete(log(Buffalo_17$TOTAL.VALUE)),
             radius = .05, opacity = 0.5,
             group = "2017 - 2018") %>%
  addCircles(data = Buffalo_20, lng = Buffalo_20$LONGITUDE, lat = Buffalo_20$LATITUDE, 
             color = ~pallete(log(Buffalo_20$TOTAL.VALUE)),
             radius = .05, opacity = 0.5,
             group = "2019 - 2020")  %>%
  addPolygons(data = Buffalo_sp, fillColor = "transparent", color = "#444444", weight = 2) %>%
  addLayersControl(overlayGroups = c("2017-2018", "2019-2020")) %>%
  addLegend(position = "bottomleft", pal = pallete, values = Buffalo_20$TOTAL.VALUE,
            title = "Single Family Home Value")
Neighborhood_map
```

# Further Data Exploration
```{r, message=F, warning=F, class.source="fold-hide"}
# Distribution of Single Family Homes by Year Built
Year_built <- ggplot(data = Buffalo_20, mapping = aes(x = YEAR.BUILT)) + 
  geom_histogram() + xlab("Year Built") + ylab("Number of Homes") +
  scale_fill_manual(values="lightblue") + theme_few() +
  labs(x="Year Built", y="Number of Homes", title="Distribution of Single Family Homes by Year Built", 
       caption="Source: Buffalo Open Data") + scale_x_continuous() + scale_y_continuous()
Year_built
```

```{r, message=F, warning=F, class.source="fold-hide"}
# Price by Living Area 2019 - 2020
live_price20 <- ggplot(data = Buffalo_20, aes(x = TOTAL.LIVING.AREA, y = TOTAL.VALUE)) +
  labs(x = "Total Living Area (sqft)", y = "Total Value Single Family Home", title = "Price by Square ft of Living Space") +
  geom_point()
live_price20
```

```{r, message=F, warning=F, class.source="fold-hide"}
# Price by Bedrooms  2019 - 2020
bed_price <- ggplot(data = Buffalo_20, aes(x = X..OF.BEDS, y = TOTAL.VALUE)) +
  labs(x = "Number of Bedrooms", y = "Total Value Single Family Home", title = "Price by Number of Bedrooms") +
  geom_col()
bed_price
```

# Regression Analysis
```{r, message=F, warning=F}
## Transform Data for Regression
Buffalo_20$log <- log10(Buffalo_20$TOTAL.VALUE)
View(Buffalo_20)

## Multiple Linear Regression
MLR <- lm(log ~ X..OF.BEDS + YEAR.BUILT +
          TOTAL.LIVING.AREA + X..OF.BATHS,
          data = Buffalo_20)
summary(MLR)
```


# Conclusions


# References

All sources are cited in a consistent manner
